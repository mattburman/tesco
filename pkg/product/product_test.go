package product

import (
	"github.com/kylelemons/godebug/pretty"
	"testing"
)

func TestURLToID(t *testing.T) {
	type args struct {
		url string
	}
	tests := []struct {
		name    string
		args    args
		want    string
		wantErr bool
	}{
		{
			"https://www.tesco.com/groceries/en-GB/products/1",
			args{"https://www.tesco.com/groceries/en-GB/products/1"},
			"1",
			false,
		},
		{
			"https://www.tesco.com/groceries/en-GB/products/123456789",
			args{"https://www.tesco.com/groceries/en-GB/products/123456789"},
			"123456789",
			false,
		},
		{
			"https://www.tesco.com/groceries/en-GB/products/987654321/",
			args{"https://www.tesco.com/groceries/en-GB/products/987654321/"},
			"987654321",
			false,
		},
		{
			"https://www.tesco.com/groceries/en-GB/products/",
			args{"https://www.tesco.com/groceries/en-GB/products/"},
			"",
			true,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			got, err := URLToID(tt.args.url)
			if (err != nil) != tt.wantErr {
				t.Errorf("URLToID() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			if got != tt.want {
				t.Errorf("URLToID() got = %v, want %v", got, tt.want)
			}
		})
	}
}

func TestNewProduct(t *testing.T) {
	type args struct {
		raw string
		url string
	}
	raw1 := `{"product":{"price":3.55,"unitPrice":13.93,"unitOfMeasure":"kg","id":"300400483","gtin":"05057545713815","baseProductId":"85011537","title":"Tesco Rump Steak 255G","description":["Beef rump steaks.","For more information about our strict welfare and quality standards visit tescoplc.com"],"brandName":"TESCO","isInFavourites":null,"defaultImageUrl":"https:\u002F\u002Fdigitalcontent.api.tesco.com\u002Fv2\u002Fmedia\u002Fghs\u002F9bb18da7-72d0-41b9-99d8-228286f9209b\u002F6bd1654b-eead-4cff-85f4-23f461cbbd95.jpeg?h=225&w=225","images":["https:\u002F\u002Fdigitalcontent.api.tesco.com\u002Fv2\u002Fmedia\u002Fghs\u002F9bb18da7-72d0-41b9-99d8-228286f9209b\u002F6bd1654b-eead-4cff-85f4-23f461cbbd95.jpeg?h=225&w=225"],"displayType":"Quantity","productType":"SingleProduct","averageWeight":null,"maxQuantityAllowed":99,"bulkBuyLimit":99,"groupBulkBuyLimit":0,"bulkBuyLimitMessage":"Sorry, there is a limit of 99 on this product","bulkBuyLimitGroupId":null,"timeRestrictedDelivery":null,"restrictedDelivery":null,"isRestrictedOrderAmendment":null,"isForSale":true,"isNew":false,"status":"AvailableForSale","foodIcons":[],"shelfLife":null,"restrictions":[],"distributorAddress":null,"manufacturerAddress":{"addressLine1":"Produced for:","addressLine2":"Tesco Stores Ltd.,","addressLine3":"Welwyn Garden City,","addressLine4":"AL7 1GA,","addressLine5":"U.K.","addressLine6":null},"importerAddress":null,"returnTo":{"addressLine1":"Tesco Stores Ltd.,","addressLine2":"Welwyn Garden City,","addressLine3":"AL7 1GA,","addressLine4":"U.K.","addressLine5":null,"addressLine6":null,"addressLine7":null,"addressLine8":null,"addressLine9":null,"addressLine10":null,"addressLine11":null,"addressLine12":null},"maxWeight":null,"minWeight":null,"increment":null,"catchWeightList":null,"reviews":{"info":{"offset":0,"total":10,"page":1,"count":10},"entries":[{"reviewId":"trn:tesco:ugc:rnr:uuid:24208a72-65e1-4766-9b9e-6914e7cb9ceb","lastModificationTime":null,"lastModeratedTime":null,"rating":{"value":1,"range":5},"status":"Approved","summary":"Fat and touch gristle","text":"For such a small piece of meat, there was a huge amount of fat and gristle that I don't think even an electric knife would have cut through.","syndicated":false,"syndicationSource":{"name":null,"logo":null,"clientId":null,"contentLink":null},"submissionTime":1572992864316},{"reviewId":"trn:tesco:ugc:rnr:uuid:1a05df51-c871-450c-b596-b552e3b06b99","lastModificationTime":null,"lastModeratedTime":null,"rating":{"value":1,"range":5},"status":"Approved","summary":"Extremely tough- avoid","text":"The worst steak I have ever had in my life. Extremely tough, despite being cooked medium. Avoid.","syndicated":false,"syndicationSource":{"name":null,"logo":null,"clientId":null,"contentLink":null},"submissionTime":1572819356035},{"reviewId":"trn:tesco:ugc:rnr:uuid:3ad68989-b906-46b5-a5a5-b826ee2520ba","lastModificationTime":null,"lastModeratedTime":null,"rating":{"value":2,"range":5},"status":"Approved","summary":"Tesco Rump Steak","text":"Better off buying these from the counter than pre-packed.","syndicated":false,"syndicationSource":{"name":null,"logo":null,"clientId":null,"contentLink":null},"submissionTime":1572019276378},{"reviewId":"trn:tesco:ugc:rnr:uuid:87eddacf-33fa-4923-8c1c-007873f8e3fe","lastModificationTime":null,"lastModeratedTime":null,"rating":{"value":2,"range":5},"status":"Approved","summary":null,"text":"Rump Steak should always be lean. These are NOT. If you want a marble through your steak you buy Sirloin. A very True fact. Tesco's Lamb steaks were free of fat (Fantastic) But Now OH Dear! Awful. They obviously do not know the differance between Rump and Sirloin!","syndicated":false,"syndicationSource":{"name":null,"logo":null,"clientId":null,"contentLink":null},"submissionTime":1570722872389},{"reviewId":"trn:tesco:ugc:rnr:uuid:a9b289f6-291f-408a-9d71-3db945ea5de7","lastModificationTime":null,"lastModeratedTime":null,"rating":{"value":1,"range":5},"status":"Approved","summary":"Awful","text":"Absolutely awful. Despite bashing it with a meat tenderisor it was still too tough to chew through. Even the dog could barely manage to get it down!","syndicated":false,"syndicationSource":{"name":null,"logo":null,"clientId":null,"contentLink":null},"submissionTime":1568313346919},{"reviewId":"trn:tesco:ugc:rnr:uuid:47e05249-800a-4402-91d6-d9365c02b19a","lastModificationTime":null,"lastModeratedTime":null,"rating":{"value":2,"range":5},"status":"Approved","summary":"Normally great","text":"I bought to make Beef Bourginon . Always had good quality. Unfortunately the gristle extended to the whole length of the pack and half its width.The pack weighed 225g and of that 63g was a piece of gristle. which was difficult to remove. My other pack was Tesco Finest which was gorgeous.The first pack was definitely substandard.","syndicated":false,"syndicationSource":{"name":null,"logo":null,"clientId":null,"contentLink":null},"submissionTime":1566150473201},{"reviewId":"trn:tesco:ugc:rnr:uuid:c4423a05-21ce-4db4-af2c-d5f1b73616e3","lastModificationTime":null,"lastModeratedTime":null,"rating":{"value":4,"range":5},"status":"Approved","summary":"Yummy","text":"Very tasty. I used a tip recently learned: crumble a well-known stock cube to use as seasoning just before cooking. Leave to rest at least 5 minutes. ","syndicated":false,"syndicationSource":{"name":null,"logo":null,"clientId":null,"contentLink":null},"submissionTime":1566075013335},{"reviewId":"trn:tesco:ugc:rnr:uuid:c43fdf3c-57fc-42af-bf64-54046b5e9281","lastModificationTime":null,"lastModeratedTime":null,"rating":{"value":5,"range":5},"status":"Approved","summary":null,"text":"These Rump steaks are very very good. I've had at least 5 of them and each time hardly any fat or any gristle. The last two I have not had to cut any off. The meat is regularly of good thickness, juicy and tender and with a smothering of Reggae Reggae BBQ and side baby potatoes, makes for a delicious meal when I get home from work. ","syndicated":false,"syndicationSource":{"name":null,"logo":null,"clientId":null,"contentLink":null},"submissionTime":1558460606335},{"reviewId":"trn:tesco:ugc:rnr:uuid:6d7f4a83-a0e7-4e55-b915-67a72de15af2","lastModificationTime":null,"lastModeratedTime":null,"rating":{"value":1,"range":5},"status":"Approved","summary":"Boot Leather","text":"Tough as old boots and sinews defeat even steak knives - avoid. I never learn and should know to avoid British beef. Irish beef is far better","syndicated":false,"syndicationSource":{"name":null,"logo":null,"clientId":null,"contentLink":null},"submissionTime":1557430261572},{"reviewId":"trn:tesco:ugc:rnr:uuid:057ef781-d385-428d-b6ab-aac3db7a80ec","lastModificationTime":null,"lastModeratedTime":null,"rating":{"value":5,"range":5},"status":"Approved","summary":"Tender and tasty","text":"I buy these steaks on a regular basis, always tender and succulent.  \r\nThe price is very reasonable,  they are beautiful with the addition of peppercorn sauce.","syndicated":true,"syndicationSource":{"name":"tesco.com","logo":null,"clientId":"BV_PIE","contentLink":null},"submissionTime":1539178068000}],"product":{"tpnb":"85011537","tpnc":null},"stats":{"countsPerRatingLevel":null,"createdOn":null,"noOfReviews":10,"overallRatingRange":5,"overallRating":2.4},"errors":[]},"multiPackDetails":null,"details":{"ingredients":[],"packSize":[{"value":"255","units":"g"}],"allergenInfo":null,"marketingTextInfo":["From Trusted Northern Irish Farms We work in partnership with trusted farmers to ensure high welfare standards from farm to fork, to deliver great quality beef.","A prime cut, chosen for a full and rich flavour"],"storage":["Suitable for home freezing. Ideally freeze as soon as possible after purchase but always by 'use by' date shown. \nDefrost thoroughly for a minimum of 24 hours in the fridge. Once defrosted use on the same day and do not refreeze. \nNot suitable for cooking from frozen. \nFollow the preparation guidelines above. \n\nKeep refrigerated. Once opened, consume within 24 hours (remove days) days and by 'use by' date shown.\n"],"nutritionInfo":[{"name":"Typical Values","perComp":"Per 100g","perServing":"One steak (255g)","referenceIntake":null,"referencePercentage":null},{"name":"Energy","perComp":"715kJ \u002F 171kcal","perServing":"1824kJ \u002F 437kcal","referenceIntake":null,"referencePercentage":null},{"name":"Fat","perComp":"10.0g","perServing":"25.5g","referenceIntake":null,"referencePercentage":null},{"name":"Saturates","perComp":"4.2g","perServing":"10.7g","referenceIntake":null,"referencePercentage":null},{"name":"Carbohydrate","perComp":"0g","perServing":"0g","referenceIntake":null,"referencePercentage":null},{"name":"Sugars","perComp":"0g","perServing":"0g","referenceIntake":null,"referencePercentage":null},{"name":"Fibre","perComp":"0g","perServing":"0g","referenceIntake":null,"referencePercentage":null},{"name":"Protein","perComp":"20.3g","perServing":"51.8g","referenceIntake":null,"referencePercentage":null},{"name":"Salt","perComp":"0.2g","perServing":"0.4g","referenceIntake":null,"referencePercentage":null},{"name":"* Reference intake of an average adult (8400 kJ \u002F 2000 kcal)","perComp":"-","perServing":"-","referenceIntake":null,"referencePercentage":null},{"name":"As sold","perComp":"-","perServing":"-","referenceIntake":null,"referencePercentage":null}],"otherNutritionInformation":null,"hazardInfo":{"chemicalName":"","productName":"","signalWord":"","statements":["Caution","Always wash hands, surfaces and utensils thoroughly after contact with raw meat.","IMPORTANT: Security Protected"],"symbolCodes":[]},"guidelineDailyAmount":{"title":"One steak","dailyAmounts":[{"name":"Energy","value":"1824kJ 437kcal","percent":"22","rating":"-"},{"name":"Fat","value":"25.5g","percent":"36","rating":"HIGH"},{"name":"Saturates","value":"10.7g","percent":"54","rating":"HIGH"},{"name":"Sugars","value":"0g","percent":"0","rating":"LOW"},{"name":"Salt","value":"0.4g","percent":"7","rating":"LOW"}]},"numberOfUses":"This pack contains 1 serving","preparationAndUsage":["Defrost thoroughly for a minimum of 12 hours in the refrigerator. Once defrosted use on the same day and do not refreeze. Follow the preparation guidelines above."],"cookingInstructions":{"oven":{"chilled":{"time":null,"instructions":[],"temperature":null},"frozen":{"time":null,"instructions":[],"temperature":null}},"microwave":{"chilled":{"detail":null,"instructions":[]},"frozen":{"detail":null,"instructions":[]}},"cookingMethods":[{"name":"Shallow Fry","instructions":["Remove the steak from the fridge and remove packaging 20 minutes before cooking. Lightly oil and season the steak. Heat a dry frying pan until very hot and cook steak for 1 minute each side, reduce to medium heat and cook for following times:","Rare: 1-3 minutes each side","Medium: 3-6 minutes each side","Well done: 7-10 minutes each side","Remove from pan and rest on a warm plate for 5 minutes.","Tip","Pepper the steak after cooking to prevent the pepper burning.","Important","Not suitable for microwave cooking. Not suitable for cooking from frozen. Tesco recommends that all meat products are cooked thoroughly. If cooked rare there is a small risk that harmful bacteria may be present."],"time":""}],"otherInstructions":[],"cookingGuidelines":[],"cookingPrecautions":[]},"freezingInstructions":null,"manufacturerMarketing":null,"productMarketing":["From Trusted Northern Irish Farms We work in partnership with trusted farmers to ensure high welfare standards from farm to fork, to deliver great quality beef.","A prime cut, chosen for a full and rich flavour"],"brandMarketing":null,"otherInformation":["Vacuum packed for freshness."],"additives":null,"warnings":["Caution","Always wash hands, surfaces and utensils thoroughly after contact with raw meat.","IMPORTANT: Security Protected"],"netContents":"255g ℮","drainedWeight":null,"safetyWarning":null,"lowerAgeLimit":null,"upperAgeLimit":null,"healthmark":null,"recyclingInfo":null,"nappyInfo":null,"alcoholInfo":null,"originInformation":[{"title":"Produce of","value":"Produced in Northern Ireland, Packed in Ireland"}],"dosage":null,"preparationGuidelines":null,"directions":null,"features":["21 day matured","A prime cut, chosen for a full and rich flavour","Expertly selected for freshness & quality"],"healthClaims":null,"boxContents":null,"nutritionalClaims":null},"depositAmount":null,"aisleName":"Fresh Beef","departmentName":"Fresh Meat & Poultry","superDepartmentName":"Fresh Food"},"promotions":[],"superDepartmentName":"Fresh Food","superDepartmentId":"b;RnJlc2glMjBGb29k","departmentName":"Fresh Meat & Poultry","departmentId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBNZWF0JTIwJiUyMFBvdWx0cnk=","aisleName":"Fresh Beef","aisleId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBNZWF0JTIwJiUyMFBvdWx0cnklN0NGcmVzaCUyMEJlZWY=","shelfName":"Beef Steaks","shelfId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBNZWF0JTIwJiUyMFBvdWx0cnklN0NGcmVzaCUyMEJlZWYlN0NCZWVmJTIwU3RlYWtz","alternativeCategories":[],"backToUrl":"\u002Fgroceries\u002Fen-GB\u002Fshop\u002Ffresh-food\u002Ffresh-meat-and-poultry\u002Ffresh-beef\u002Fall","template":"grocery","breadcrumbs":[{"label":"Home","linkTo":"\u002Fgroceries\u002Fen-GB\u002F"},{"label":"Fresh Food","catId":"b;RnJlc2glMjBGb29k","linkTo":"\u002Fgroceries\u002Fen-GB\u002Fshop\u002Ffresh-food\u002Fall"},{"label":"Fresh Meat & Poultry","catId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBNZWF0JTIwJiUyMFBvdWx0cnk=","linkTo":"\u002Fgroceries\u002Fen-GB\u002Fshop\u002Ffresh-food\u002Ffresh-meat-and-poultry\u002Fall"},{"label":"Fresh Beef","catId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBNZWF0JTIwJiUyMFBvdWx0cnklN0NGcmVzaCUyMEJlZWY=","linkTo":"\u002Fgroceries\u002Fen-GB\u002Fshop\u002Ffresh-food\u002Ffresh-meat-and-poultry\u002Ffresh-beef\u002Fall"},{"label":null}],"referer":"\u002Fgroceries\u002Fen-GB\u002F","asyncPage":true,"robots":"index","canonicalUrl":"https:\u002F\u002Fwww.tesco.com\u002Fgroceries\u002Fen-GB\u002Fproducts\u002F300400483","pageTitle":"Tesco Rump Steak 255G","pageDescription":"Beef rump steaks. For more information about our strict welfare and quality standards visit tescoplc.com","structuredData":"[{\"@context\":\"http:\u002F\u002Fschema.org\",\"@type\":\"Corporation\",\"url\":\"https:\u002F\u002Fwww.tesco.com\u002Fgroceries\",\"contactPoint\":[{\"@type\":\"ContactPoint\",\"telephone\":\"+44-0800 323 4040\",\"areaServed\":\"UK\",\"contactType\":\"customer service\",\"availableLanguage\":\"English\",\"contactOption\":\"TollFree\"}]},{\"@context\":\"http:\u002F\u002Fschema.org\",\"@type\":\"WebSite\",\"url\":\"https:\u002F\u002Fwww.tesco.com\u002Fgroceries\",\"name\":\"Tesco Groceries\"},{\"@context\":\"http:\u002F\u002Fschema.org\u002F\",\"name\":\"Tesco Rump Steak 255G\",\"@type\":\"Product\",\"image\":[\"https:\u002F\u002Fdigitalcontent.api.tesco.com\u002Fv2\u002Fmedia\u002Fghs\u002F9bb18da7-72d0-41b9-99d8-228286f9209b\u002F6bd1654b-eead-4cff-85f4-23f461cbbd95.jpeg?h=225&w=225\"],\"gtin13\":\"05057545713815\",\"sku\":\"300400483\",\"description\":\"Beef rump steaks. For more information about our strict welfare and quality standards visit tescoplc.com\",\"offers\":{\"@type\":\"Offer\",\"url\":\"https:\u002F\u002Fwww.tesco.com\u002Fgroceries\u002Fen-GB\u002Fproducts\u002F300400483\",\"priceCurrency\":\"GBP\",\"price\":3.55,\"itemCondition\":\"http:\u002F\u002Fschema.org\u002FNewCondition\",\"availability\":\"http:\u002F\u002Fschema.org\u002FInStock\",\"seller\":{\"@context\":\"http:\u002F\u002Fschema.org\",\"@type\":\"Corporation\",\"url\":\"https:\u002F\u002Fwww.tesco.com\u002Fgroceries\",\"contactPoint\":[{\"@type\":\"ContactPoint\",\"telephone\":\"+44-0800 323 4040\",\"areaServed\":\"UK\",\"contactType\":\"customer service\",\"availableLanguage\":\"English\",\"contactOption\":\"TollFree\"}]}},\"brand\":{\"@type\":\"Corporation\",\"name\":\"TESCO\"},\"aggregateRating\":{\"@type\":\"AggregateRating\",\"ratingValue\":2.4,\"reviewCount\":10}},{\"@context\":\"http:\u002F\u002Fschema.org\u002F\",\"@type\":\"BreadcrumbList\",\"itemListElement\":[{\"@type\":\"ListItem\",\"position\":1,\"item\":{\"@id\":\"\u002Fgroceries\u002Fen-GB\u002F\",\"name\":\"Home\"}},{\"@type\":\"ListItem\",\"position\":2,\"item\":{\"@id\":\"\u002Fgroceries\u002Fen-GB\u002Fshop\u002Ffresh-food\u002Fall\",\"name\":\"Fresh Food\"}},{\"@type\":\"ListItem\",\"position\":3,\"item\":{\"@id\":\"\u002Fgroceries\u002Fen-GB\u002Fshop\u002Ffresh-food\u002Ffresh-meat-and-poultry\u002Fall\",\"name\":\"Fresh Meat & Poultry\"}},{\"@type\":\"ListItem\",\"position\":4,\"item\":{\"@id\":\"\u002Fgroceries\u002Fen-GB\u002Fshop\u002Ffresh-food\u002Ffresh-meat-and-poultry\u002Ffresh-beef\u002Fall\",\"name\":\"Fresh Beef\"}}]}]","restOfShelfUrl":"\u002Fshop\u002Ffresh-food\u002Ffresh-meat-and-poultry\u002Ffresh-beef\u002Fbeef-steaks","experiments":{"oop507":"507-c"},"recommendations":{"experiment":{"experiment":"oop507","variation":"507-c"},"data":{"85011537":{"pageInformation":{"count":4,"title":"Usually bought next","pageId":"26ff2b2e-1e33-4d1f-9b2f-c85997c547b9"},"productItems":[{"product":{"shortDescription":null,"bulkBuyLimitMessage":"Sorry, there is a limit of 99 on this product","unitOfMeasure":"100g","isRestrictedOrderAmendment":null,"shelfId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBNZWF0JTIwJiUyMFBvdWx0cnklN0NGcmVzaCUyMFN0b2NrcywlMjBTdHVmZmluZyUyMCYlMjBBY2NvbXBhbmltZW50cyU3Q0ZyZXNoJTIwU3RvY2s=","unitPrice":0.667,"groupBulkBuyLimit":0,"isForSale":true,"bulkBuyLimit":99,"restrictions":[],"superDepartmentId":"b;RnJlc2glMjBGb29k","productType":"SingleProduct","price":1.2,"minWeight":0,"departmentId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBNZWF0JTIwJiUyMFBvdWx0cnk=","aisleName":"Fresh Stocks, Stuffing & Accompaniments","restrictedDelivery":null,"context":null,"increment":0,"catchWeightList":null,"brandName":"Tesco","status":"AvailableForSale","bulkBuyLimitGroupId":null,"averageWeight":null,"defaultImageUrl":"https:\u002F\u002Fimg.tesco.com\u002FGroceries\u002Fpi\u002F739\u002F5053947796739\u002FIDShot_225x225.jpg","shelfName":"Fresh Stock","isNew":false,"substitutions":{},"superDepartmentName":"Fresh Food","title":"Tesco Peppercorn Sauce 180G","maxQuantityAllowed":99,"isInFavourites":null,"baseProductId":"65964614","id":"279867779","maxWeight":0,"timeRestrictedDelivery":null,"displayType":"Quantity","departmentName":"Fresh Meat & Poultry","aisleId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBNZWF0JTIwJiUyMFBvdWx0cnklN0NGcmVzaCUyMFN0b2NrcywlMjBTdHVmZmluZyUyMCYlMjBBY2NvbXBhbmltZW50cw=="},"cost":0,"quantity":0,"customerUnitChoice":"pcs","promotions":[],"promotionMessages":{},"promotionRewards":{},"itemLimitReached":false,"groupLimitReached":false,"groupBulkBuyQuantity":0,"originalQuantity":0,"originalProductWeight":0,"originalCatchWeight":0,"isNewlyAdded":false,"isSubstitute":false,"seedProduct":{},"isWhyNotTry":false},{"product":{"shortDescription":null,"bulkBuyLimitMessage":"Sorry, there is a limit of 99 on this product","unitOfMeasure":"100g","isRestrictedOrderAmendment":null,"shelfId":"b;Rm9vZCUyMEN1cGJvYXJkJTdDQ29va2luZyUyMEluZ3JlZGllbnRzJTdDUG91ciUyME92ZXIlMjBTYXVjZXMlN0NQZXBwZXJjb3JuJTIwUG91ciUyME92ZXIlMjBTYXVjZQ==","unitPrice":3.4,"groupBulkBuyLimit":0,"isForSale":true,"bulkBuyLimit":99,"restrictions":[],"superDepartmentId":"b;Rm9vZCUyMEN1cGJvYXJk","productType":"SingleProduct","price":0.85,"minWeight":0,"departmentId":"b;Rm9vZCUyMEN1cGJvYXJkJTdDQ29va2luZyUyMEluZ3JlZGllbnRz","aisleName":"Pour Over Sauces","restrictedDelivery":null,"context":null,"increment":0,"catchWeightList":null,"brandName":"Schwartz","status":"AvailableForSale","bulkBuyLimitGroupId":null,"averageWeight":null,"defaultImageUrl":"https:\u002F\u002Fimg.tesco.com\u002FGroceries\u002Fpi\u002F069\u002F5000225005069\u002FIDShot_225x225.jpg","shelfName":"Peppercorn Pour Over Sauce","isNew":false,"substitutions":{},"superDepartmentName":"Food Cupboard","title":"Schwartz Creamy Pepper Sauce 25G","maxQuantityAllowed":99,"isInFavourites":null,"baseProductId":"51584987","id":"258092039","maxWeight":0,"timeRestrictedDelivery":null,"displayType":"Quantity","departmentName":"Cooking Ingredients","aisleId":"b;Rm9vZCUyMEN1cGJvYXJkJTdDQ29va2luZyUyMEluZ3JlZGllbnRzJTdDUG91ciUyME92ZXIlMjBTYXVjZXM="},"cost":0,"quantity":0,"customerUnitChoice":"pcs","promotions":[{"promotionId":"A32766558","promotionType":"2for","startDate":"2019-11-20T00:00:00.000Z","endDate":"2019-12-30T00:00:00.000Z","offerText":"Any 2 for £1.00"}],"promotionMessages":{},"promotionRewards":{},"itemLimitReached":false,"groupLimitReached":false,"groupBulkBuyQuantity":0,"originalQuantity":0,"originalProductWeight":0,"originalCatchWeight":0,"isNewlyAdded":false,"isSubstitute":false,"seedProduct":{},"isWhyNotTry":false},{"product":{"shortDescription":null,"bulkBuyLimitMessage":"Sorry, there is a limit of 99 on this product","unitOfMeasure":"100g","isRestrictedOrderAmendment":null,"shelfId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBWZWdldGFibGVzJTdDTXVzaHJvb21zJTdDTGFyZ2UlMjAmJTIwRmxhdCUyME11c2hyb29tcw==","unitPrice":0.4,"groupBulkBuyLimit":0,"isForSale":true,"bulkBuyLimit":99,"restrictions":[],"superDepartmentId":"b;RnJlc2glMjBGb29k","productType":"SingleProduct","price":1,"minWeight":0,"departmentId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBWZWdldGFibGVz","aisleName":"Mushrooms","restrictedDelivery":null,"context":null,"increment":0,"catchWeightList":null,"brandName":"Tesco","status":"AvailableForSale","bulkBuyLimitGroupId":null,"averageWeight":null,"defaultImageUrl":"https:\u002F\u002Fimg.tesco.com\u002FGroceries\u002Fpi\u002F766\u002F0000003284766\u002FIDShot_225x225.jpg","shelfName":"Large & Flat Mushrooms","isNew":false,"substitutions":{},"superDepartmentName":"Fresh Food","title":"Tesco Large Flat Mushrooms 250G","maxQuantityAllowed":99,"isInFavourites":null,"baseProductId":"84794319","id":"299916749","maxWeight":0,"timeRestrictedDelivery":null,"displayType":"Quantity","departmentName":"Fresh Vegetables","aisleId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBWZWdldGFibGVzJTdDTXVzaHJvb21z"},"cost":0,"quantity":0,"customerUnitChoice":"pcs","promotions":[],"promotionMessages":{},"promotionRewards":{},"itemLimitReached":false,"groupLimitReached":false,"groupBulkBuyQuantity":0,"originalQuantity":0,"originalProductWeight":0,"originalCatchWeight":0,"isNewlyAdded":false,"isSubstitute":false,"seedProduct":{},"isWhyNotTry":false},{"product":{"shortDescription":null,"bulkBuyLimitMessage":"You are able to order a maximum of 20 of this item","unitOfMeasure":"kg","isRestrictedOrderAmendment":null,"shelfId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBWZWdldGFibGVzJTdDUG90YXRvZXMlMjAmJTIwU3dlZXQlMjBQb3RhdG9lcyU3Q0Jha2luZyUyMCYlMjBKYWNrZXQlMjBQb3RhdG9lcw==","unitPrice":1,"groupBulkBuyLimit":0,"isForSale":true,"bulkBuyLimit":20,"restrictions":[],"superDepartmentId":"b;RnJlc2glMjBGb29k","productType":"LooseProduce","price":0.3,"minWeight":0,"departmentId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBWZWdldGFibGVz","aisleName":"Potatoes & Sweet Potatoes","restrictedDelivery":null,"context":null,"increment":0,"catchWeightList":null,"brandName":"Tesco","status":"AvailableForSale","bulkBuyLimitGroupId":"G00029581","averageWeight":0.3,"defaultImageUrl":"https:\u002F\u002Fimg.tesco.com\u002FGroceries\u002Fpi\u002F000\u002F0262410000000\u002FIDShot_225x225.jpg","shelfName":"Baking & Jacket Potatoes","isNew":false,"substitutions":{},"superDepartmentName":"Fresh Food","title":"Tesco Baking Potatoes Loose","maxQuantityAllowed":20,"isInFavourites":null,"baseProductId":"50503464","id":"253558183","maxWeight":0,"timeRestrictedDelivery":null,"displayType":"QuantityOrWeight","departmentName":"Fresh Vegetables","aisleId":"b;RnJlc2glMjBGb29kJTdDRnJlc2glMjBWZWdldGFibGVzJTdDUG90YXRvZXMlMjAmJTIwU3dlZXQlMjBQb3RhdG9lcw=="},"cost":0,"quantity":0,"customerUnitChoice":"pcs","promotions":[],"promotionMessages":{},"promotionRewards":{},"itemLimitReached":false,"groupLimitReached":false,"groupBulkBuyQuantity":0,"originalQuantity":0,"originalProductWeight":0,"originalCatchWeight":0,"isNewlyAdded":false,"isSubstitute":false,"seedProduct":{},"isWhyNotTry":false}]}}}}`
	url1 := "https://www.tesco.com/groceries/en-GB/products/300400483"
	tests := []struct {
		name    string
		args    args
		want    *Product
		wantErr bool
	}{
		{
			"product",
			args{
				raw1,
				"https://www.tesco.com/groceries/en-GB/products/300400483",
			},
			&Product{
				name: "Tesco Rump Steak 255G",
				source: Source{
					url:  url1,
					id:   "300400483",
					name: "tesco",
				},
				description: []string{
					"Beef rump steaks.",
					"For more information about our strict welfare and quality standards visit tescoplc.com",
				},
				raw:                             raw1,
				hashOfRawValueLastUsedToCompute: "fb922cd9d416c64e186ee13f161149e646ad8409",
				perComp: Macros{
					per:     "Per 100g",
					size:    100,
					carbs:   0,
					protein: 20.3,
					fat:     10,
					kcal:    171,
				},
				perServing: Macros{
					per:     "One steak (255g)",
					size:    255,
					carbs:   0,
					protein: 51.8,
					fat:     25.5,
					kcal:    437,
				},
			},
			false,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			got, err := NewProduct(tt.args.raw, tt.args.url)
			if (err != nil) != tt.wantErr {
				t.Errorf("NewProduct() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			if diff := pretty.Compare(got, tt.want); diff != "" {
				t.Errorf("%s: post-AddCrew diff: (-got +want)\n%s", tt.name, diff)
			}
			//if !reflect.DeepEqual(got, tt.want) {
			//	t.Errorf("NewProduct()\ngot = %v\nwant %v", got, tt.want)
			//}
		})
	}
}
